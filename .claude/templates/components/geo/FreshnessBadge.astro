---
/**
 * FreshnessBadge - GEO signal for content recency
 *
 * Displays the last updated date prominently. AI systems factor in
 * content freshness when deciding what to cite. Recent updates signal
 * that information is current and reliable.
 *
 * STANDALONE VERSION - No external dependencies required.
 * Works with or without Tailwind CSS.
 *
 * Usage in MDX:
 * <FreshnessBadge lastUpdated="2025-01-15" />
 * <FreshnessBadge lastUpdated={frontmatter.lastUpdated} />
 */

interface Props {
  lastUpdated: string | Date
  class?: string
}

const { lastUpdated, class: className = '' } = Astro.props

const date = typeof lastUpdated === 'string' ? new Date(lastUpdated) : lastUpdated
const formatted = date.toLocaleDateString('en-US', {
  month: 'short',
  day: 'numeric',
  year: 'numeric',
})

// Calculate days since update
const daysSince = Math.floor((Date.now() - date.getTime()) / (1000 * 60 * 60 * 24))
const isRecent = daysSince <= 30
---

<div
  class:list={[
    'geo-freshness-badge',
    'not-prose inline-flex items-center gap-1.5 rounded-full px-3 py-1 text-xs font-medium',
    isRecent
      ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400'
      : 'bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400',
    className
  ]}
  data-recent={isRecent}
  aria-label={`Last updated ${formatted}`}
>
  <svg
    class="geo-icon h-3 w-3"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
    aria-hidden="true"
  >
    <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
    <path d="M3 3v5h5" />
    <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16" />
    <path d="M16 16h5v5" />
  </svg>
  <span>Updated {formatted}</span>
</div>

<style>
  /* Fallback styles for projects without Tailwind */
  .geo-freshness-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 500;
  }

  /* Recent (green) state */
  .geo-freshness-badge[data-recent="true"] {
    background-color: #dcfce7;
    color: #166534;
  }

  /* Older (gray) state */
  .geo-freshness-badge[data-recent="false"] {
    background-color: #f3f4f6;
    color: #4b5563;
  }

  .geo-icon {
    width: 0.75rem;
    height: 0.75rem;
  }

  /* Dark mode fallback */
  @media (prefers-color-scheme: dark) {
    .geo-freshness-badge[data-recent="true"] {
      background-color: rgba(22, 101, 52, 0.3);
      color: #4ade80;
    }

    .geo-freshness-badge[data-recent="false"] {
      background-color: #1f2937;
      color: #9ca3af;
    }
  }
</style>
